package backend

import (
	"fmt"
	"io"
	"net/http"
	"strings"
)

const url string = "https://cloudqa-dashboard.arubadev.cloud.hpe.com/api/datasources/proxy/uid/qDaBgRfVk/_msearch?max_concurrent_shard_requests=5"

const payload string = "{\"search_type\":\"query_then_fetch\",\"ignore_unavailable\":true,\"index\":\"trivy_director_summary_fedramp_test\"}\n{\"size\":10000,\"query\":{\"bool\":{\"filter\":[{\"range\":{\"timestamp\":{\"gte\":1705231087248,\"lte\":1707823087248,\"format\":\"epoch_millis\"}}},{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"cluster_name:panzer AND vul_type=ALL\"}}]}},\"sort\":[{\"timestamp\":{\"order\":\"desc\",\"unmapped_type\":\"boolean\"}},{\"_doc\":{\"order\":\"desc\"}}],\"script_fields\":{}}\n"

var header http.Header = http.Header{
	"Accept-Encoding": {"gzip", "deflate", "br"},
	"Accept-Language": {"en-US,en;q=0.9"},
	"Connection": {"keep-alive"},
	"Content-Length": {"443"},
	"Cookie": {"_gcl_au=1.1.1111268726.1700235389; _mkto_trk=id:117-SZC-407&token:_mch-hpe.com-1700235388780-49819; AMCV_56B5A25055667EED7F000101%40AdobeOrg=MCMID|91310952061851586751015969433465087430; _abck=D01002A4126672E2D4AD1FCC22139B9B~-1~YAAQDjkgF7WTqNyLAQAAdmCw8Ar9UMdL5H3EWBP7GJv/ZUjA9gsLknOf7iIH4OaPCUnXGp6w8sCHz4PiSWcR2FYLKWrHtq1Wd0Jvi1fFgYKkuvQPbSvX7gtBYSP4HJ8sbhKYSafx/sIRbjBVdYhoyhkoogVvl/XYOUKzVEELjxMlNg/gOw92JMXQRgkbqeCvhvTkHYBuMm57qU9pqMY2xCtubzdfI4lwMpkS9ngNKQ0w9doXeLYQfJ0KBaGMv+Mmz7L50Ve9TreRqmIcu7QWXN3KE6h7wR2e/3SCS/MGizz+6z8h4of+znYkKgFuKLtSQ7OC/2KhozgYt79KSM4JHQFCk7VnABLH4eZ8svML~-1~-1~-1; kndctr_56B5A25055667EED7F000101_AdobeOrg_identity=CiY5MTMxMDk1MjA2MTg1MTU4Njc1MTAxNTk2OTQzMzQ2NTA4NzQzMFISCN7btO%2D9MRABGAEqA09SMjAA8AHm18GFvzE%3D; hpe_mn_nn=v=mhu3IuNmnY3jYwsC20muhd6BI6wQPN0UpVp8lqkki5r3ZuUzg1W7u2N4aLmqF4F7UjGOaJInQtMsd3if9Fet+J5QMtjoVIOiNSYCGrzz1/flBj0OgTA0xHRYEFzz9spywhhGeA3LcnFbtTSxAN8eMRDETkK8QtmghdFKmHRYHCNrSXu2DapOnL0PNIlkNDIq/hTF2Nl+PBK1ziVPe0pNzlw6onhraWLs+mwhSXnMrVxxxA8EsIBpO2Ou+FVfC1ZJrILHew/VNa2Yx5GvAj5iKwqPw2qhSgflIhMeLa3y5mQ=&c=AA; HPEITGICCUID=oilxYRi4c0BNHg4D4KbYtKPnz39qPvy5pbTD2vvx1IpL; HPEITGUID=kmB3AaKgkAcpDiHJLkMqjlWSEFoMJ8xIU16VPQOz1R7h; grafana_session=b31e7645b20883a633eb36fa705b9b32; grafana_session_expiry=1707844915"},
	"Host": {"cloudqa-dashboard.arubadev.cloud.hpe.com"},
	"Origin": {"https://cloudqa-dashboard.arubadev.cloud.hpe.com"},
	"Referer": {"https://cloudqa-dashboard.arubadev.cloud.hpe.com/d/TxSRzWwnk/central-trivy-overview?orgId=1&var-ENV=panzer"},
	"Sec-Fetch-Dest": {"empty"},
	"Sec-Fetch-Mode": {"cors"},
	"Sec-Fetch-Site": {"same-origin"},
	"User-Agent": {"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0"},
	"accept": {"application/json", "text/plain", "*/*"},
	"content-type": {"application/x-ndjson"},
	"sec-ch-ua": {"\"Not A(Brand\";v=\"99\"", "\"Microsoft Edge\";v=\"121\"", "\"Chromium\";v=\"121\""},
	"sec-ch-ua-mobile": {"?0"},
	"sec-ch-ua-platform": {"\"Windows\""},
	"x-grafana-org-id": {"1"},
}

func getGraphanaData() {
	c := http.Client{}
	req, _ := http.NewRequest(http.MethodGet, url, strings.NewReader(payload))
	req.Header = header
	resp, err := c.Do(req)
	if err != nil {
		fmt.Println("An error occured", err)
	}
	out, err :=  io.ReadAll(resp.Body)
	if err != nil {
		fmt.Println("Couldn't read", err)
	}
	fmt.Println(string(out))
}
