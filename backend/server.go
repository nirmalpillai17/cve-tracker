package backend

import (
	"net/http"
	"time"

	"github.com/gorilla/mux"
	gl "github.com/nirmalpillai17/cve_tracker/global"
)

func NewHttpServer(a string) *http.Server {
	r := mux.NewRouter()
	s := r.PathPrefix("/grafana/data").Subrouter()
	s.PathPrefix("/files/").Handler(
		http.StripPrefix("/grafana/data/files/",
			http.FileServer(http.Dir(gl.Cm.OutDir))))
	s.HandleFunc("/refresh_data", refreshData).Methods(http.MethodGet)
	s.HandleFunc("/refresh_data/{id:[0-9]+}", pollHandler).Methods(http.MethodGet)
	s.HandleFunc("/set_cookie", setCookie).Methods(http.MethodGet)
	s.HandleFunc("/", viewData).Methods(http.MethodGet)
	s.HandleFunc("/logs", viewLogs).Methods(http.MethodGet)
	return &http.Server{
		Addr:         a,
		Handler:      s,
		ReadTimeout:  10 * time.Second,
		WriteTimeout: 10 * time.Second,
	}
}
